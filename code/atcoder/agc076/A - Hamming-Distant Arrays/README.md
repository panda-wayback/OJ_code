# A - Hamming-Distant Arrays

**链接**：[AGC076 A](https://atcoder.jp/contests/agc076/tasks/agc076_a)

## 题意

- 给定整数 N（1 ≤ N ≤ 50）。
- 构造 N 个长度为 N² 的序列 x₁,…,xₙ，每个序列值域为 [1,N]，顺序区分。
- 对任意长度 N²、值域 [1,N] 的序列 y，若都存在某个 i 满足 **d(xᵢ, y) ≥ N² − N**，则这一组 (x₁,…,xₙ) 合法。
- 其中 d(a,b) 为 a、b 对应位置不同的个数。
- 求合法 (x₁,…,xₙ) 的数量，对 998244353 取模。

## 等价条件（题解核心）

- 定义 **BAD**：存在某个 y，使得对所有 i 都有 d(xᵢ, y) ≤ N² − N − 1。
- 把 (x₁,…,xₙ) 看成 N² 列，每列是 N 个数（每行一个）。对第 j 列，令 **dⱼ** = 该列中出现次数最多的数的出现次数（众数频数）。
- **结论**：BAD ⟺ ∑ⱼ dⱼ ≥ N² + N。  
  因此 **答案** = 满足 ∑ⱼ dⱼ < N² + N 的 (x₁,…,xₙ) 个数。

## 做法概要

1. **单列方案数 f(t)**  
   - F(t) = 单列 N 个数、值域 [1,N]、每种数出现次数都 ≤ t 的方案数（内部用 DP + 组合数求）。
   - f(t) = F(t) − F(t−1)，即单列众数频数**恰好**为 t 的方案数。

2. **总得分与“超额分”**  
   - 总得分 S = ∑ⱼ dⱼ，要 S < N² + N。  
   - 设 L = N²（列数），则每列至少贡献 1，故 S = L +（每列多出来的部分）。把每列多出来的部分叫「超额分」：该列众数频数为 t 时，超额分 = t − 1。  
   - 总超额分 = S − L，要 S < L + N 即 **总超额分 < N**，所以总超额分只可能在 [0, N−1]。

3. **主 DP（按总超额分）**  
   - `dp[i][j]` = 考虑前 i 列，当前**总超额分**为 j 的方案数（j ∈ [0, N−1]）。
   - 转移：第 i+1 列众数频数可取 t=1..N，超额分为 t−1，则  
     `dp[i+1][j + (t−1)] += dp[i][j] * f[t]`，且只保留 j + (t−1) < N。
   - 用两行滚动即可，状态数 O(N)，每列 O(N²)，总复杂度 **O(L·N²) = O(N⁴)**。

4. **答案**  
   - 对 j = 0..N−1 求和 `dp[L][j]`（L = N²），再对 998244353 取模。

## 复杂度

- 预处理 F(t)、f(t)：O(N²) 的 DP，做 N 次，共 O(N³)。
- 主 DP：O(L·N²) = O(N⁴)。
- 空间：O(N)。
